# tox.ini
[tox]
env_list = 
    py{310,311,312}-core,
    py{310,311,312}-audio,
    py{310,311,312}-spi,
    py{310,311,312}-all
isolated_build = True
requires = 
    tox-uv>=1.0.0

[testenv]
# Common configuration for all environments
deps =
    pytest>=8.3.2
    pytest-xdist>=3.6.1
    pytest-cov>=6.0.0
    xdoctest[all]>=1.1.6
    tomli>=2.0.1
    setuptools>=72.1.0
    loguru>=0.7.2
set_env =
    PYTHONPATH = {toxinidir}
    PY_IGNORE_IMPORTMISMATCH = 1
commands_pre =
    python -c "import sys; print(f'Python {sys.version}')"

[testenv:py{310,311,312}-core]
# Core-only installation - no optional dependencies
commands =
    # Run core tests (excluding optional dependency tests)
    pytest -xvs -m "not optional_deps" --no-cov

[testenv:py{310,311,312}-audio]
# Install with audio extras
extras = audio
commands =
    # Run tests including audio tests
    pytest -xvs -m "optional_deps('audio')" --no-cov

[testenv:py{310,311,312}-spi]
# Install with spi extras
extras = spi
allowlist_externals =
    R
    Rscript
commands_pre =
    {[testenv]commands_pre}
    # Ensure R 'sn' package is available
    Rscript -e "if(!require('sn')) { install.packages('sn', repos='https://cloud.r-project.org') }"
commands =
    # Run tests including spi tests
    pytest -xvs -m "optional_deps('spi')" --no-cov

[testenv:py{310,311,312}-all]
# Full installation with all extras
extras = all
allowlist_externals =
    R
    Rscript
commands_pre =
    {[testenv]commands_pre}
    # Ensure R 'sn' package is available
    Rscript -e "if(!require('sn')) { install.packages('sn', repos='https://cloud.r-project.org') }"
commands =
    # Run all tests
    pytest -xvs --no-cov